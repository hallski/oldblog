
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Simply Hacking</title>
  <meta name="author" content="Mikael Hallendal">

  
  <meta name="description" content="Just pushed the first cut of a small framework to connect with the newly launched chatservice Convore. In short Convore is an attempt to create a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://simplyhacking.com/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Simply Hacking" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-755873-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Simply Hacking</a></h1>
  
    <h2>Mac OS X and iOS Programming</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:simplyhacking.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/mhconvore.html">Initial Release of MHConvore</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-16T00:00:00+01:00" pubdate data-updated="true">Feb 16<span>th</span>, 2011</time>
        
         | <a href="/mhconvore.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just pushed the first cut of a small framework to connect with the newly launched chatservice <a href="http://convore.com/">Convore</a>. In short Convore is an attempt to create a better way to chat than IRC and also support a web frontend while making it possible to connect with native clients.</p>

<p>The API will likely change a bit and it&#8217;s fresh out of the editor so might be a bit flaky still.</p>

<p>The API makes heavy use of blocks for actions initiated from your code and a client listener for notifications initiated from the server.</p>

<p>A small example of how you use the API, I will add a better example later.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">@interface</span> <span class="nc">AppDelegate</span> : <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">NSApplicationDelegate</span><span class="p">,</span> <span class="n">MHConvoreClientListener</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'><span class="k">@private</span>
</span><span class='line'>    <span class="n">MHConvoreClient</span> <span class="o">*</span><span class="n">client</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">connectToServer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">MHConvoreClient</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="p">[</span><span class="n">MHConvoreClient</span> <span class="nl">clientWithUsername:</span><span class="s">@&quot;u&quot;</span> <span class="nl">password:</span><span class="s">@&quot;p&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">client</span><span class="p">.</span><span class="n">listener</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">client</span> <span class="nl">verifyAccount:</span><span class="o">^</span> <span class="p">(</span><span class="n">MHConvoreUser</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//   [self doSomething];</span>
</span><span class='line'>            <span class="p">[</span><span class="n">client</span> <span class="n">listen</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error while verifying account: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Called when the client receives a new message */</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">newMessage:</span><span class="p">(</span><span class="n">MHConvoreMessage</span> <span class="o">*</span><span class="p">)</span><span class="n">message</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;[%@]: %@&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">.</span><span class="n">message</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To connect to Convore you first need to create an account through their website.</p>

<p>There still is work that needs to be done to it so feel free to fork and hack on it. For example there is currently no way to cancel the listener.</p>

<p><a href="https://github.com/mhallendal/mhconvore">The code at Github</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/code-separation-using-blocks.html">Code Separation Using Blocks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-24T00:00:00+01:00" pubdate data-updated="true">Jan 24<span>th</span>, 2011</time>
        
         | <a href="/code-separation-using-blocks.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is a short blog entry to describe how you can use blocks to seperate a generic code from problem specific using blocks. Those that have been looking at <a href="http://projecteuler.net">Project Euler</a> might recognize this problem description.</p>

<p>The program is supposed to calculate the sum of all even-valued <a href="http://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci numbers</a> that doesn&#8217;t exceed a <tt>STOP_VALUE</tt>.</p>

<p>To keep the Fibonacci calculations generic I wanted to separate the problem specific logic from the code calculating the Fibonacci sequence. Blocks can be really helpful for that which is shown below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">+</span> <span class="nl">sequenceWithBlock:</span><span class="o">^</span> <span class="kt">void</span> <span class="p">(</span><span class="n">NSInteger</span> <span class="n">value</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span><span class="n">stop</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This method accepts a block that is called for every Fibonacci number in the sequence until the blocks sets the <tt>stop</tt> flag. The problem specific code is then placed inside the block.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">__block</span> <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">Fibonacci</span> <span class="nl">sequenceWithBlock:</span><span class="o">^</span> <span class="kt">void</span> <span class="p">(</span><span class="n">NSInteger</span> <span class="n">value</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span><span class="n">stop</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">STOP_VALUE</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">stop</span> <span class="o">=</span> <span class="n">YES</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">total</span> <span class="o">+=</span> <span class="n">value</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/debug-method-in-xcode.html">Debug Method in Xcode</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-18T00:00:00+02:00" pubdate data-updated="true">Aug 18<span>th</span>, 2010</time>
        
         | <a href="/debug-method-in-xcode.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I often find myself add a bunch of <tt>#ifdef</tt>s for code that I only want executed during the development but not in the shipped products. In order to make the code a bit easier to read I decided to make a small method that takes a C block (available in iOS 4.0 and Mac OS X 10.6) instead.</p>

<p>You would use it like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Simple example of usage</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &quot;debug.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span>
</span><span class='line'><span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">debug</span><span class="p">(</span><span class="o">^</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Your debug code here</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can download <tt>debug.[ch]</tt> from <a href="http://gist.github.com/534487">GitHub</a> and simply add them to your project. You also need to edit your project settings for the Debug configuration to set the <tt>DEBUG</tt> macro.</p>

<p><img src="/images/posts/project-settings-debug.png" alt="Project Settings Dialog" /></p>

<p><a href="http://gist.github.com/534487">http://gist.github.com/534487</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/spacedust-xcode-theme-for-xcode-4.html">Spacedust Xcode Theme for Xcode 4</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-16T00:00:00+02:00" pubdate data-updated="true">Aug 16<span>th</span>, 2010</time>
        
         | <a href="/spacedust-xcode-theme-for-xcode-4.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Thanks to <a href="http://gist.github.com/488120">mrevils script</a> to convert Xcode 3 themes to Xcode 4 I updated my <a href="http://simplyhacking.com/spacedust-xcode-theme.html">Spacedust</a> theme to Xcode 4.</p>

<p><img src="/images/posts/spacedust-xcode-theme.png"/></p>

<p>Download and installation instructions are available at in the link below.</p>

<p><a href="http://gist.github.com/527103">http://gist.github.com/527103</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/spacedust-xcode-theme.html">Spacedust Xcode Theme</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-30T00:00:00+01:00" pubdate data-updated="true">Jan 30<span>th</span>, 2010</time>
        
         | <a href="/spacedust-xcode-theme.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I decided it was time to create a new Xcode theme and created one that works well with dark backgrounds. It&#8217;s called <em>Spacedust</em> and should look good on most dark tints.</p>

<p><img src="/images/posts/spacedust-xcode-theme.png"/></p>

<p>Feel free to grab it if you like it.</p>

<p><a href="/files/Spacedust.xccolortheme.zip" onClick="javascript: pageTracker._trackPageview('/files/Spacedust.xccolortheme.zip');">Spacedust.xccolortheme.zip</a></p>

<p>To install it, simply unpack it and place <code>Spacedust.xccolortheme.zip</code> in:
<code>~/Library/Application Support/Xcode/Color\ Themes</code>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/core-animation-layered-clock.html">Core Animation Layered Clock</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-12T00:00:00+02:00" pubdate data-updated="true">Oct 12<span>th</span>, 2009</time>
        
         | <a href="/core-animation-layered-clock.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I wanted to get into Core Animation a bit over the weekend and decided to write a simple digital clock. With the help from <a href="http://rhult.github.com/">Richard</a> I set out to hack it up and figured it might be useful for others just starting out with Core Animation.</p>

<p><img src="/images/posts/glossy-clock.png" alt="Resulting App" /></p>

<p>After creating a normal Cocoa Application and setting up a custom view in Interface Builder it&#8217;s time to setup the layers that will make up the final interface. Make sure that you set the custom view to your class so that it is actually used:</p>

<p><img src="/images/posts/glossy-clock-ib.png" alt="Info panel in Interface Builder" /></p>

<p>Layers in Core Animation are built up as a tree where the layer you set to your view with <code>setLayer:</code> is the root layer. All other layers are added as sublayers to the root layer or another layer with <code>addSublayer:</code>. In the code snippets below <code>backgroundLayer</code> is my root layer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="n">setupLayers</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">backgroundLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">setupBackgroundLayer</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">backgroundLayer</span> <span class="nl">addSublayer:</span><span class="p">[</span><span class="n">self</span> <span class="n">setupClockFaceLayer</span><span class="p">]];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">backgroundLayer</span> <span class="nl">addSublayer:</span><span class="p">[</span><span class="n">self</span> <span class="n">setupBorderLayer</span><span class="p">]];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">backgroundLayer</span> <span class="nl">addSublayer:</span><span class="p">[</span><span class="n">self</span> <span class="n">setupGlossLayer</span><span class="p">]];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">backgroundLayer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">initWithFrame:</span><span class="p">(</span><span class="n">NSRect</span><span class="p">)</span><span class="n">frame</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">initWithFrame:</span><span class="n">frame</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">clockTimer</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ClockTimer</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">setLayer:</span><span class="p">[</span><span class="n">self</span> <span class="n">setupLayers</span><span class="p">]];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">awakeFromNib</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">self</span> <span class="nl">setWantsLayer:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>ClockTimer</code> is a simple class that updates the string displaying the time once a second. This string is available through the property <code>outputString</code> on the <code>ClockTimer</code> object.</p>

<p>As you can see the clock is built up from four different layers: The background layer, a clock face layer, a border layer and finally a gloss layer adding the nice shine.</p>

<h2>The Background Layer:</h2>

<p>The background layer is created as a <code>CAGradientLayer</code> to give the clock background the nice blue gradient. This layer type was added in 10.6 so it won&#8217;t work on earlier versions of Mac OS X but should be fairly straight forward to do manually.</p>

<p>In order to help with positioning of layers Core Animation comes with the notion of Layout Managers which can be added to a layer in order to layout its sublayers. The CAConstraintLayoutManager lets us set constraints on the layers sublayers in order to control how they are positioned. In this case the constraints will be set on the clock face to make it centered on the background.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="n">setupBackgroundLayer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">backgroundLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAGradientLayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">CGColorRef</span> <span class="n">gradientColor1</span> <span class="o">=</span> <span class="n">CGColorCreateGenericRGB</span><span class="p">(</span><span class="mf">13.0f</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="mf">116.0f</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
</span><span class='line'>    <span class="n">CGColorRef</span> <span class="n">gradientColor2</span> <span class="o">=</span> <span class="n">CGColorCreateGenericRGB</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">53.0f</span><span class="o">/</span><span class="mf">255.0f</span><span class="p">,</span> <span class="mf">126.0f</span><span class="o">/</span><span class="mf">255.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSArray</span> <span class="nl">arrayWithObjects:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">gradientColor1</span><span class="p">,</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">gradientColor2</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">CFRelease</span><span class="p">(</span><span class="n">gradientColor1</span><span class="p">);</span>
</span><span class='line'>    <span class="n">CFRelease</span><span class="p">(</span><span class="n">gradientColor2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[(</span><span class="n">CAGradientLayer</span> <span class="o">*</span><span class="p">)</span><span class="n">backgroundLayer</span> <span class="nl">setColors:</span><span class="n">colors</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">backgroundLayer</span> <span class="nl">setCornerRadius:</span><span class="mf">12.0f</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">CAConstraintLayoutManager</span> <span class="o">*</span><span class="n">layout</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAConstraintLayoutManager</span> <span class="n">layoutManager</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">backgroundLayer</span> <span class="nl">setLayoutManager:</span><span class="n">layout</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">backgroundLayer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The ClockFace Layer:</h2>

<p>Core Animation comes with several layer types to help us with various tasks. One of these is the <code>CATextLayer</code> which like the name suggests, make it really easy to output text. It also makes it really easy to customize how the text is displayed by setting font and font size. Using the normal shadow properties from <code>CALayer</code> you can add a nice drop shadow on the text.</p>

<p>Using Cocoa bindings I connect the text layers <code>string</code> property with the <code>outputString</code> on my <code>ClockTimer</code>. This way the layer will automatically redraw itself everytime the timer updates the output string.</p>

<p>This is also where we setup the constraints mentioned above to make sure that the text is centered in relation to its super layer (in this case the background).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="n">setupClockFaceLayer</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CATextLayer</span> <span class="o">*</span><span class="n">clockFaceLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CATextLayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">clockFaceLayer</span> <span class="nl">bind:</span><span class="s">@&quot;string&quot;</span> <span class="nl">toObject:</span><span class="n">clockTimer</span> <span class="nl">withKeyPath:</span><span class="s">@&quot;outputString&quot;</span> <span class="nl">options:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">clockFaceLayer</span> <span class="nl">setFont:</span><span class="s">@&quot;Menlo&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">clockFaceLayer</span> <span class="nl">setFontSize:</span><span class="mf">60.0f</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">clockFaceLayer</span> <span class="nl">setShadowOpacity:</span><span class="mf">.9f</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Constrain the text layer in the middle</span>
</span><span class='line'>    <span class="n">CAConstraint</span> <span class="o">*</span><span class="n">constraint</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAConstraint</span> <span class="nl">constraintWithAttribute:</span><span class="n">kCAConstraintMidX</span>
</span><span class='line'>                                                          <span class="nl">relativeTo:</span><span class="s">@&quot;superlayer&quot;</span>
</span><span class='line'>                                                           <span class="nl">attribute:</span><span class="n">kCAConstraintMidX</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">clockFaceLayer</span> <span class="nl">addConstraint:</span><span class="n">constraint</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">constraint</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAConstraint</span> <span class="nl">constraintWithAttribute:</span><span class="n">kCAConstraintMidY</span>
</span><span class='line'>                                            <span class="nl">relativeTo:</span><span class="s">@&quot;superlayer&quot;</span>
</span><span class='line'>                                             <span class="nl">attribute:</span><span class="n">kCAConstraintMidY</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">clockFaceLayer</span> <span class="nl">addConstraint:</span><span class="n">constraint</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">clockFaceLayer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Border Layer:</h2>

<p>There are likely other ways of doing this but by using a separate layer I can use built in functionality to draw a border around a layer. I make the layer slightly smaller than the background layer, set its corner radius to the same value used for the background and simply set it to draw its border with a white color.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="n">setupBorderLayer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">CALayer</span> <span class="o">*</span><span class="n">borderLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CALayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'>    <span class="n">CGRect</span> <span class="n">borderRect</span> <span class="o">=</span> <span class="n">CGRectInset</span><span class="p">([</span><span class="n">self</span> <span class="n">frame</span><span class="p">],</span> <span class="mf">8.0f</span><span class="p">,</span> <span class="mf">8.0f</span><span class="p">);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">borderLayer</span> <span class="nl">setCornerRadius:</span><span class="mf">12.0f</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">borderLayer</span> <span class="nl">setBorderColor:</span><span class="n">CGColorGetConstantColor</span><span class="p">(</span><span class="n">kCGColorWhite</span><span class="p">)];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">borderLayer</span> <span class="nl">setBorderWidth:</span><span class="mf">2.0f</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">borderLayer</span> <span class="nl">setFrame:</span><span class="n">borderRect</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">borderLayer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice that I do not have to set any constraints here as I create the layer frame from simply shrinking the frame size on all sides which ensures it will be set in the middle already.</p>

<h2>The Gloss Layer:</h2>

<p>As a final touch I wanted to add the shine to give the clock a glossy look. The simplest way I could figure out to do this was to create a transparent image in Photoshop and setup the layer to draw it. Optimally it should be generated in code or at least use a scalable image to make the clock resizable without loosing any quality in the gloss layer.</p>

<p>Even if we set the same corner radius as the background layer the layer will happily draw the image outside of this unless we call <code>setMasksToBounds</code> to ensure that it doesn&#8217;t draw the image outside of the rounded corners.</p>

<figure class='code'><figcaption><span>setupGlossLayer</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">-</span> <span class="p">(</span><span class="n">CALayer</span> <span class="o">*</span><span class="p">)</span><span class="n">setupGlossLayer</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">CALayer</span> <span class="o">*</span><span class="n">glossLayer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CALayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSString</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSBundle</span> <span class="n">mainBundle</span><span class="p">]</span> <span class="nl">pathForResource:</span><span class="s">@&quot;clock-gloss&quot;</span> <span class="nl">ofType:</span><span class="s">@&quot;png&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSURL</span> <span class="o">*</span><span class="n">fileURL</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">fileURLWithPath:</span><span class="n">filePath</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">CGImageSourceRef</span> <span class="n">glossySource</span> <span class="o">=</span> <span class="n">CGImageSourceCreateWithURL</span><span class="p">((</span><span class="n">CFURLRef</span><span class="p">)</span><span class="n">fileURL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>    <span class="n">CGImageRef</span> <span class="n">glossyImage</span> <span class="o">=</span> <span class="n">CGImageSourceCreateImageAtIndex</span><span class="p">(</span><span class="n">glossySource</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>    <span class="n">CFRelease</span><span class="p">(</span><span class="n">glossySource</span><span class="p">);</span>
</span><span class='line'>    <span class="p">[</span><span class="n">glossLayer</span> <span class="nl">setContents:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">glossyImage</span><span class="p">];</span>
</span><span class='line'>    <span class="n">CFRelease</span><span class="p">(</span><span class="n">glossyImage</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">glossLayer</span> <span class="nl">setOpacity:</span><span class="mf">0.8f</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">glossLayer</span> <span class="nl">setCornerRadius:</span><span class="mf">12.0f</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">glossLayer</span> <span class="nl">setMasksToBounds:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">glossLayer</span> <span class="nl">setFrame:</span><span class="p">[</span><span class="n">self</span> <span class="n">frame</span><span class="p">]];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">glossLayer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally I subclassed <code>NSWindow</code> in order to turn off the window decoration and shape the window as the background layer.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nl">initWithContentRect:</span><span class="p">(</span><span class="n">NSRect</span><span class="p">)</span><span class="n">contentRect</span>
</span><span class='line'>                <span class="nl">styleMask:</span><span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">aStyle</span>
</span><span class='line'>                  <span class="nl">backing:</span><span class="p">(</span><span class="n">NSBackingStoreType</span><span class="p">)</span><span class="n">bufferingType</span>
</span><span class='line'>                    <span class="nl">defer:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="n">flag</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nl">initWithContentRect:</span><span class="n">contentRect</span>
</span><span class='line'>                            <span class="nl">styleMask:</span><span class="n">NSBorderlessWindowMask</span>
</span><span class='line'>                              <span class="nl">backing:</span><span class="n">bufferingType</span>
</span><span class='line'>                                <span class="nl">defer:</span><span class="n">flag</span><span class="p">];</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">setOpaque:</span><span class="n">NO</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">setBackgroundColor:</span><span class="p">[</span><span class="n">NSColor</span> <span class="n">clearColor</span><span class="p">]];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">setMovableByWindowBackground:</span><span class="n">YES</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">self</span> <span class="nl">setLevel:</span><span class="n">NSPopUpMenuWindowLevel</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>NSBorderlessWindowMask</code> makes the window draw without the border and <code>setOpaque</code> together with setting the background color to <code>[NSColor clearColor]</code>. Using the <code>NSPopUpMenuWindowLevel</code> ensures that the clock is always on top of other windows.</p>

<p>I hope you find this helpful and please make sure to subscribe to my feed if you did. I&#8217;ll do my best to answer any questions you might have in the comment section below.</p>

<p>The full source as an Xcode project can be browsed at: <a href="http://github.com/mhallendal/glossyclock">Github</a> or <a href="http://github.com/mhallendal/glossyclock/zipball/master">downloaded</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/reverse-array-in-objc.html">Reversing an Array in Objective C</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-09T00:00:00+02:00" pubdate data-updated="true">Oct 9<span>th</span>, 2009</time>
        
         | <a href="/reverse-array-in-objc.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Was looking for the best way to reverse an array in Objective C and stumbled over this solution that might not be obvious to everyone (wasn&#8217;t to me at least).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSArray</span> <span class="o">*</span><span class="n">reversedArray</span> <span class="o">=</span> <span class="p">[[</span><span class="n">array</span> <span class="n">reverseObjectEnumerator</span><span class="p">]</span> <span class="n">allObjects</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/macruby-support-in-any-cocoa-application.html">Macruby Support in Any Cocoa Application</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-06T00:00:00+02:00" pubdate data-updated="true">May 6<span>th</span>, 2009</time>
        
         | <a href="/macruby-support-in-any-cocoa-application.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Yesterday I published a post about <a href="/cocoa-prototyping-with-webview.html">Cocoa Prototyping with Webview</a> and today I found out about <a href="http://www.macruby.org/">Macruby</a> thanks to <a href="http://twitter.com/sarnesjo">@sarnesjo</a>. Already looking for ways of prototyping in Cocoa it&#8217;s hard to not find Macruby very interesting.</p>

<p>Macruby turns out to be a very powerful tool for prototyping (as well as writing entire applications in) as it fits perfectly fine in a normal Objective-C code base. What I wanted was something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">SimpleController</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:label</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:button</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:my_view</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">buttonPressed</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
</span><span class='line'>        <span class="n">label</span><span class="o">.</span><span class="n">setStringValue</span><span class="p">(</span><span class="s2">&quot;I am (im)pressed!&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">my_view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">NSColor</span><span class="o">.</span><span class="n">redColor</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Where the view <code>:my_view</code> is implemented in Objective-C.</p>

<p>Here are the simple steps I used to hook it into a normal Xcode Cocoa project.</p>

<p>First of all, install Macruby which is as easy as downloading the zip-file from the website and run the installer.</p>

<p>In order to link to the Macruby framework you need to use garbage collection in your project, if you aren&#8217;t already you enable it in the project inspector:</p>

<p><img src="/images/posts/macruby-in-xcode-gc.png" alt="Set the project to use Garbage Collection" /></p>

<p>Next you need to make your project link against the Macruby framework:</p>

<p><img src="/images/posts/macruby-in-xcode-add-framework.png" alt="Add the Macruby framework" /></p>

<p>That&#8217;s it for the project settings, let&#8217;s hook it up in the code. When you use the built-in project template for a Macruby project a small Ruby file called <em>rb_main.rb</em> is created for you. Since I&#8217;m using a generic Cocoa application template I needed to create this file and simply copied the file into my new project (its code below). It loads all Ruby files in your bundle and starts the Cocoa main loop.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Loading the Cocoa framework. If you need to load more frameworks, you can</span>
</span><span class='line'><span class="c1"># do that here too.</span>
</span><span class='line'><span class="n">framework</span> <span class="s1">&#39;Cocoa&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Loading all the Ruby project files.</span>
</span><span class='line'><span class="n">dir_path</span> <span class="o">=</span> <span class="no">NSBundle</span><span class="o">.</span><span class="n">mainBundle</span><span class="o">.</span><span class="n">resourcePath</span><span class="o">.</span><span class="n">fileSystemRepresentation</span>
</span><span class='line'><span class="no">Dir</span><span class="o">.</span><span class="n">entries</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">path</span> <span class="o">!=</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">path</span><span class="o">[-</span><span class="mi">3</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;.rb&#39;</span>
</span><span class='line'>    <span class="nb">require</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Starting the Cocoa main loop.</span>
</span><span class='line'><span class="no">NSApplicationMain</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kp">nil</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>To start the actual Ruby interpreter the file <em>main.m</em> needs to be modified. Since the Ruby code now starts the Cocoa main loop we no longer need to do that in <code>main</code>. <em>Main.m</em> simply becomes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#import &lt;MacRuby/MacRuby.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">macruby_main</span><span class="p">(</span><span class="s">&quot;rb_main.rb&quot;</span><span class="p">,</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>With these changes you can now start writing code in either Ruby or Objective-C within the same project. Here are the files I ended up with in my very small example.</p>

<p><img src="/images/posts/macruby-in-xcode-files.png" alt="Example Files" /></p>

<p>The final application simply shows a small window with a button:</p>

<p><img src="/images/posts/macruby-in-xcode-example.png" alt="Example window" /></p>

<p>Make sure to watch the great <a href="http://pragmaticstudio.com/screencasts/6-macruby">introductionary screencast</a> then download the example project and get started tinkering.</p>

<p><a href="/downloads/posts/ObjcMacRuby.tar.gz">Example project</a></p>

<p>If you find this as cool and useful as I did, let me hear about it!</p>

<p><strong>Edit:</strong> Be sure to read Laurents comment below for an alternative way of loading your Ruby files into your application.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/cocoa-prototyping-with-webview.html">Cocoa Prototyping With Webview</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-05T00:00:00+02:00" pubdate data-updated="true">May 5<span>th</span>, 2009</time>
        
         | <a href="/cocoa-prototyping-with-webview.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While Interface Builder makes it really easy to quickly put together and test the overall design of your user interface it doesn&#8217;t help much when it comes to its overall flow. In any non-trivial application you are likely to have some custom views or view switching.</p>

<p>For example, say that you want to try out whether it makes sense to use a source list in order to navigate the application and have your content view switch based on what you select in it.</p>

<p>Wouldn&#8217;t it be great if you could try this without having to implement all the code necessary to display and navigate the source list and other views. Using HTML for prototyping can be a powerful, quick and easy solution that is easily available to Cocoa developers.</p>

<p>In order to make it even easier I created a <code>WebView</code> subclass called <code>PrototypeView</code> that displays a piece of HTML and sends a message to its <em>delegate</em> when the user clicks a link.</p>

<p>To give an idea of what it does, take a look at the following screenshot showing a basic prototype UI consisting of two suchs views embedded in a split view.</p>

<p><img src="/images/posts/html-prototype-ui.png" alt="Prototyped UI, using PrototypeView" /></p>

<p>Using the PrototypeView is easy.</p>

<h2>Step 1: Mock up the UI in Interface Builder</h2>

<p>Using Interface Builder, create the UI you want and put custom views where you want to prototype using the <code>PrototypeView</code>.</p>

<p><img src="/images/posts/html-prototype-ib.png" alt="Setting class to PrototypeView" /></p>

<p>I used a class called <code>AppController</code> with two outlets to the prototype views by creating an <code>NSObject</code> subclass and set it up in Interface Builder by dragging an <code>NSObject</code> from the library and setting the class to <code>AppController</code> like above.</p>

<h2>Step 2: Hooking the view up in the AppController</h2>

<p>Back in XCode I create a subclass of NSObject called AppController and setup the two prototype views in its <code>awakeFromNib</code> by using the two method calls <code>setPrototypeDelegate</code> and <code>loadBundleFile</code>. In my example I used two prototype views called <code>sidebarView</code> and <code>contentView</code> and will use the AppController as my delegate.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">awakeFromNib</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">sideBarView</span> <span class="nl">setPrototypeDelegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">sideBarView</span> <span class="nl">loadBundleFile:</span><span class="s">@&quot;sidebar&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">contentView</span> <span class="nl">setPrototypeDelegate:</span><span class="n">self</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">contentView</span> <span class="nl">loadBundleFile:</span><span class="s">@&quot;content1&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Step 3: Prototype in HTML</h2>

<p>Starting the application at this point will cause it to load the files <em>sidebar.html</em> and <em>content1.html</em> and display them. Now that the files are being loaded you can implement the prototyped UI portions in the HTML files. Here is the content of <em>sidebar.html</em>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>  <span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;sidebar.css&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li&gt;&lt;p</span> <span class="na">class=</span><span class="s">&quot;header&quot;</span><span class="nt">&gt;</span>LIBRARY<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>        <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>          <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;method:showViewOne&quot;</span><span class="nt">&gt;</span>Initial View<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>          <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;method:showViewTwo&quot;</span><span class="nt">&gt;</span>Second View<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Step 4: Adding the methods in AppController</h2>

<p>Notice the special links to <code>method:showViewOne</code>, clicking this will make the <code>PrototypeView</code> look if its delegate responds to <code>showViewOne</code> and send the message to it if it does.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">showViewOne</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">contentView</span> <span class="nl">loadBundleFile:</span><span class="s">@&quot;content1&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">showViewTwo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">contentView</span> <span class="nl">loadBundleFile:</span><span class="s">@&quot;content2&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s it, happy prototyping!</p>

<p>For a closer look you can see the <a href="http://gist.github.com/106856">PrototypeView source code</a> or download the example project I used as a <a href="/downloads/posts/HtmlPrototype.tar.gz">tarball</a>.</p>

<p>I&#8217;d love any feedback on how to improve this and possibly even supporting using JavaScript to communicate both ways with the HTML view in order to let the application update the views dynamically.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog-at-github.html">Blogging at Github and Simply Hacking</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-20T00:00:00+02:00" pubdate data-updated="true">Apr 20<span>th</span>, 2009</time>
        
         | <a href="/blog-at-github.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p class="meta">20 Apr 2009 &#8211; Stockholm</p>
<p>Decided to move my blog to a simpler solution by using Github and the nice <a href="http://github.com/mojombo/jekyll">Jekyll</a> site generator by <a href="http://tom.preston-werner.com/">Tom Preston-Werner</a>.</p>
<p>Still need to tweak the stylesheetes a bit to not be a total rip off from Toms (which he is kind enough to let others use) but I definitely like the clean design.</p>
<p>Really looking forward to a simpler blog system where I don&#8217;t need to manage an <span class="caps">SQL</span> database and keep the software up to date. Comments are done through <a href="http://disqus.com">Disqus</a>.</p></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/mhconvore.html">Initial release of MHConvore</a>
      </li>
    
      <li class="post">
        <a href="/code-separation-using-blocks.html">Code Separation Using Blocks</a>
      </li>
    
      <li class="post">
        <a href="/debug-method-in-xcode.html">Debug Method in Xcode</a>
      </li>
    
      <li class="post">
        <a href="/spacedust-xcode-theme-for-xcode-4.html">Spacedust Xcode Theme for Xcode 4</a>
      </li>
    
      <li class="post">
        <a href="/spacedust-xcode-theme.html">Spacedust Xcode Theme</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/mhallendal">@mhallendal</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mhallendal',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("mhallendal", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/mhallendal" class="twitter-follow-button" data-show-count="false">Follow @mhallendal</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Mikael Hallendal -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'simplyhacking';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
